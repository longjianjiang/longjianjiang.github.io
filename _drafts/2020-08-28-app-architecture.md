
# 架构模式学习笔记

架构有很多种，不论什么架构，笔者认为他们想要达到的目的都是一致的，让软件开发更容易维护和扩展。

不同的架构他们的逻辑都是一致的，首先是拆分各个模块，每个模块之间是职责单一的，其次是定义各个模块之间的数据流动，以上两步完成了，就是一个所谓的架构。

# MVVM

我们这边有一个需求也用到了MVVM，这个需求是这样，一个屏幕里面有两个tableview，这两个tableview是联动的。有点类似美团外卖点单的需求，但更加复杂的地方在于，左边的tableview是带section的，以及右边tableview的内容不是一次API就能够请求到所有数据的。

所以我们有两个viewmodel，viewmodel负责生成tableview，并且以readonly的方式对外提供给controller去做addsubview和布局的事情。

viewmodel是tableview的delegate和datasource。一旦左边产生select事件，这个事件就被viewmodel接收到，然后代理给controller，controller此时调度给右边tableview的viewmodel，针对右边tableview的所有操作都由viewmodel去处理了。

viewmodel对外提供了一个方法接收API数据，controller在进入页面时，加载API，并获得API数据，然后交给viewmodel。viewmodel在遇到翻页场景时，再代理给controller去发起api请求。api之所以放在controller中做，是因为这个viewmodel和tableview会被复用到其他业务线，API不能写死在viewmodel里面。

总的来说，viewmodel做的事情就是处理不同tableview的行为，虽然它作为tableview的datasource，但并不是一个model的角色。之所以不用mvc是因为如果把这些行为放在controller里面，controller就要在同一个tableview代理方法里面区分不同的tableview来做不同的事情，所以拆分成两个对象各自管理各自的tableview，这两个拆分出来的对象就是viewmodel。
