

## 什么是指令

每个计算机程序由若干机器指令构成，这些指令顺序执行，或者跳跃执行（if），循环执行（for）。

指令的格式一般如下所示：

```
[操作码字段, 地址码字段]
```

指令的执行一般有四个周期：

```
取指周期：访问内存，取指令；
间址周期：访问内存，取EA；
执行周期：访问内存，取操作数；
中断周期：访问内存，保存程序断点；
```

## 寻址方式

指令寻址的目的有两点，第一是确定本条指令的数据地址，第二是确定下一条执行指令的地址。

寻址分为指令寻址，数据寻址。

### 指令寻址

指令寻址分为顺序寻址和跳转寻址，对应代码逻辑就是顺序执行和选择循环执行。

程序开始执行时，首条指令的地址会被送入程序计数器（PC），接下来PC会自动存放下一条指令的地址。

当遇到跳跃的指令，此时会修改PC中地址，接下来之后的执行，和顺序执行一样，PC会自动存放下一条指令的地址。

### 数据寻址

数据寻址有很多种不同的方式，所以指令中必须有一个字段来进行标识是使用哪一种寻址方式，所以地址码字段格式如下所示：

```
[寻址特征, 形式地址A]
```

根据寻址特征得到的有效地址叫做EA。

- 立即寻址

指令中A存储的就是操作数本身。

- 直接寻址

指令中A存储的是操作数的地址，此时经过一次内存访问即可得到EA。

- 隐含寻址

有些指令需要不止一个操作数，指令中仅存储其中一个操作数地址，另一个放到寄存器中，可以缩短指令的长度。

- 间接寻址

指令中存储的并不是操作数的地址，而是间接的地址，类似二级指针或者多级指针，此时地址的首位用来标记是否需要继续访问地址，0表示此时地址就是EA的地址，再访问一次就可以取得操作数。

此时需要不止一次的访问内存才能得到EA，好处在于可以扩大寻址范围，因为直接寻址时，指令中存在A的位数是固定的。

- 寄存器寻址

指令中存储寄存器编号，操作数存在在对应的寄存器中。

- 寄存器间接寻址

指令中存储寄存器编号，寄存器中存储操作的地址。

逻辑同间接寻址，相比间接寻址，使用寄存器可以少访问一次内存。

- 基址寻址

存在基址寄存器BR，EA = A + BR，指令中存储的A此时是一个偏移。

可以扩大指令的寻址范围，当内存很大的时候，内存分为若干段，只需要更改BR为段的首地址，可以做到访问所有内存。

- 变址寻址

存在变址寄存器IX，EA = A + IX，指令中存储的A此时是首地址，IX中存储的是偏移。

这种寻址方式方便数据数组问题，A存储数组首地址，不断变化IX可以进行遍历数组，可以有效减少指令的长度。

- 相对寻址

EA = PC + A，此时A也是一个偏移，使用补码的形式存储，可正可负。

一般作为转移指令来使用。

- 堆栈寻址 

主要依赖SP寄存器，固定指向当前栈的顶部。

PUSH操作，先进行SP的减小，腾出空间，然后将内容存到新空间中。

POP操作，先取顶部空间中的数据，然后进行SP增加，等于释放了一段区域。

# References

[计算机组成原理-唐朔飞](https://github.com/zhaojunHouse/studyGuide/blob/master/%E3%80%8A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E3%80%8B%E5%94%90%E6%9C%94%E9%A3%9E.pdf)
