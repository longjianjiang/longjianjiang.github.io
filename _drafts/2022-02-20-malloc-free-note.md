
# malloc & free

malloc在分配小于128k（可由M_MMAP_THRESHOLD选项调节），使用brk系统调用分配内存，将_edata指针往高地址推，此时是虚拟内存地址，第一次读/写的时候，触发缺页中断才会分配物理内存。

所以这种分配的方式的缺点在于容易造成内存碎片，得_edata指针往下的一整段都释放，才能进行内存紧缩。

所以当大于128k的内存时，此时使用mmap的方式进行分配内存。堆-栈中间的区域分配一块内存，这块内存可以单独的进行释放。

[ref](https://www.cnblogs.com/vinozly/p/5489138.html)
