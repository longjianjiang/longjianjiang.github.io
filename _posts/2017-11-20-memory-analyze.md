---
layout: post
title:  "【Tips】UIScrollView用autolayout设置约束无法滚动？"
date:   2016-11-14
excerpt: "今天做项目，碰到一个需求，在一个Cell中，因为需要适配4‘，所以需要将原本的一行按钮换成UIScrollView，可以滑动。"
tag:
- scrollView
- autolayout
comments: true
---

> 本文是笔者学习内存管理相关的笔记，以下是笔记思路：


ARC是苹果为我们提供的内存管理方式，也就是**引用计数**的方式，它和MRC相比就是不需要开发者书写设置引用计数的代码，编译器会自动的在合适的位置添加，大大减少了开发者的工作量。
**垃圾回收**是相对于引用计数的另一种内存管理方式，相比引用计数，垃圾回收的优势在于可以回收循环引用，而引用计数则需要通过弱引用打破循环引用从而正确回收，而垃圾回收的缺点在于速度较慢。

说到循环引用，之前在tips中记录过iOS开发中常见的由于block导致循环引用的场景，下面本文来分析下其中的细节。

block亦或是Swift中的闭包都是引用类型( 下文统一以blcok说明)，因为是引用所以会存在循环引用的可能。那么为什么blcok会导致循环引用呢？

> OC中block和Swift中闭包基本差不多，但是有一点不同是： Swift中闭包所捕获的变量默认是加上OC中__block关键字的，也就是说Swift中闭包中的变量我们是可以改变其值的，不过Swift也会做一些优化，如果闭包中并没有改变变量，此时就仅仅拷贝，此时就和OC中blcok是同样的操作了。

这涉及到两个问题，作用域和存储域。因为block相当于一个匿名函数，也就是一段代码块，这段代码块通常会进行传递，但是当blcok变量超出变量作用域，此时block变量会被废弃，这样其他地方也就不能使用这段代码。为什么会被废弃，因为此时的blcok变量存储在栈中，为了使该代码块在其他地方依然可以被使用，block会被复制到堆上，这样就能达到目的。

同时因为block中可能会使用到其他变量，因为将block复制到堆的过程中，同样的会将blcok中捕获的变量复制到堆上，同时block会持有这些变量(变量为引用类型)，这个因为此时这些变量的管理由block负责了，block会在复制到堆时，对这些变量retain一次，blcok被废弃时，对这些变量进行release一次，符合内存管理的原则。

正是因为block参与了捕获变量的 内存管理，所以会导致循环引用的发生，而解决办法通过弱引用即可。
