---
layout: post
title:  "HTTP学习笔记"
date:   2019-01-24
excerpt:  "本文是笔者学习HTTP的笔记"
tag:
- Networking
comments: true
---

# TLS/SSL

TLS(Transport Layer Security)是一个安全协议，前身是SSL(Secure Sockets Layer)，https(HTTP Over TLS)就是通过TLS来对传输内容进行加密的,下面笔者使用 `Wireshark` 观察TLS握手的过程，完整过程如图所示:

![http_note_1]({{site.url}}/assets/images/blog/http_note_1.png)

> 可以看到在进行TLS握手之前，前面是TCP的三次握手;

- Client Hello

这一步客户端会发送自己运行的TLS版本(Version)，支持的加密方式(Cipher Suites)，同时会生成一个随机数(Random)记做 `client random`，抓包如下所示:

![http_note_2]({{site.url}}/assets/images/blog/http_note_2.png)

- Server Hello + Certificate + Server Key Exchange + Server Hello Done

1.服务端收到消息后，会确认一个加密方式(Cipher Suites)，生成一个随机数(Random)记做 `server random`。

2.同时发送证书给客户端(Certificate)。

`Server Key Exchange`中同时会发送一个公钥(Pubkey)和签名(Signature)，下面客户端会用证书来验证服务器发来的公钥和签名是否有效，如下所示:

![http_note_3]({{site.url}}/assets/images/blog/http_note_3.png)

- Client Key Exchange + Change Cipher Spec + Encrypted Handshake Message

当客户端收到服务端发来的证书后，首先会用本地保存的证书的公钥对证书进行解密，如果可以解密，证明上一步服务端发送的公钥是有效的，然后客户端继续生成一个随机数，使用服务端的公钥进行加密，发送给服务端, 如下所示:

![http_note_4]({{site.url}}/assets/images/blog/http_note_4.png)

- Change Cipher Spec + Encrypted Handshake Message

服务端此时会用自己的私钥，解密客户端发来的数据，证明此时握手完成。

- Application Data

此后，双方根据约定好的加密方式，使用前面的三个随机数，生成一个对话密钥(session key)，用来加密接下来的会话过程。

所以TLS的握手阶段使用的是非对称加密，后面的会话过程则使用的是对称加密。